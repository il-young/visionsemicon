//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop


#include <string>
#include <stdio.h>
#include <windows.h>

#include "STKC.h"
#include "Change_AutoM_frm.h"
#include "LinkStatusChange_frm.h"
#include "Carrier_ToAGVPortPopup_frm.h"
#include "Carrier_ToPGVPortPopup_frm.h"
#include "Carrier_FormTopopup_frm.h"
#include "Carrier_LockComment_frm.h"
#include "History_Alarmform.h"
#include "History_Eventform.h"
#include "History_TransferCommandform.h"
#include "History_Operationform.h"
#include "History_Carrier_Historyform.h"
#include "Statistics_WorkTimeform.h"
#include "Statistics_Time_statistics_processform.h"
#include "System_UserManagementform.h"
#include "System_UserGroupingform.h"
#include "System_Max_PoolLevelform.h"
#include "Operation_ShelfTestForm.h"
#include "Operation_Shelf_Position_Confirmation_form.h"



//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma link "AdvGrid"
#pragma link "AdvObj"
#pragma link "BaseGrid"
#pragma link "EZGEMLib_OCX"
#pragma resource "*.dfm"


Tstkc_frm *stkc_frm;



extern WideString GetBstr(const String sVal)
{
	return static_cast<WideString>(sVal);
};

//---------------------------------------------------------------------------
__fastcall Tstkc_frm::Tstkc_frm(TComponent* Owner)
	: TForm(Owner)
{
	Change_AutoManual_frm = new TChange_AutoManual_frm(this);
	Link_Status_Change_frm = new TLink_Status_Change_frm(this);
	Carrier_ToAGVPort_Popup_frm = new TCarrier_ToAGVPort_Popup_frm(this);
	Carrier_ToPGVPort_Popup_frm = new TCarrier_ToPGVPort_Popup_frm(this);
	Carrier_FormTo_popup_frm = new TCarrier_FormTo_popup_frm(this);
	Carrier_Lock_Comment_frm = new TCarrier_Lock_Comment_frm(this);
	History_Alarm_frm = new THistory_Alarm_frm(this);
	History_Event_frm = new THistory_Event_frm(this);
	History_TransferCommand_frm = new THistory_TransferCommand_frm(this);
	History_Operation_frm = new THistory_Operation_frm(this);
	History_Carrier_History_frm = new THistory_Carrier_History_frm(this);
	Statistics_WorkTime_frm = new TStatistics_WorkTime_frm(this);
	Statistics_Time_statistics_process_frm = new TStatistics_Time_statistics_process_frm(this);
	System_UserManagement_frm = new TSystem_UserManagement_frm(this);
	System_UserGrouping_frm = new TSystem_UserGrouping_frm(this);
	System_Max_PoolLevel_frm = new TSystem_Max_PoolLevel_frm(this);
	Operation_ShelfTest_frm = new TOperation_ShelfTest_frm(this);
	Operation_Shelf_Position_Confirmation_frm = new TOperation_Shelf_Position_Confirmation_frm(this);
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Carrier_GridGetCellColor(TObject *Sender, int ARow, int ACol,
          TGridDrawState AState, TBrush *ABrush, TFont *AFont)
{
//	if (ACol == 1 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//	 //Carrier_Grid->Cells[1][1] = "Alex";
//
//   }
//   if (ACol == 1 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 1 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 1 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clRed;
//   }
////---------------------------------------------------------------------------
//   if (ACol == 2 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 2 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 2 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 2 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clRed;
//   }
////---------------------------------------------------------------------------
//	if (ACol == 3 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 3 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 3 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 3 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
//if (ACol == 4 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 4 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 4 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 4 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
//if (ACol == 5 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 5 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 5 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 5 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
//if (ACol == 6 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 6 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 6 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 6 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
//if (ACol == 7 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 7 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 7 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clSilver;
//   }
//   if (ACol == 7 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clBlack;
//   }
////---------------------------------------------------------------------------
//if (ACol == 8 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 8 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 8 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 8 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
//if (ACol == 9 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 9 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 9 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 9 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
//if (ACol == 10 && ARow == 1)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMenuHighlight;
//   }
//   if (ACol == 10 && ARow == 2)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 10 && ARow == 3)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
//   if (ACol == 10 && ARow == 4)
//   {
//	 Carrier_Grid->Canvas->Brush->Color = clMoneyGreen;
//   }
////---------------------------------------------------------------------------
}
//---------------------------------------------------------------------------


void __fastcall Tstkc_frm::FormCreate(TObject *Sender)
{

	//Setting_Frm->Read_Setting();

	gd_carrier->RemoveRows(0,5);

	gd_carrier->AddRow();


	/*
	Carrier_Grid->Cells[1][1] = "  15/12/31\n  08:47:57\n  12NL047";
	Carrier_Grid->Cells[1][2] = "  15/12/31\n  06:37:57\n  12NL055";
	Carrier_Grid->Cells[1][3] = "  15/12/31\n  07:45:57\n  12NL157";
	Carrier_Grid->Cells[1][4] = "  15/12/31\n  08:47:57\n  12NL047\n  Lock";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[2][1] = "  15/12/31\n  09:47:57\n  12NL046";
	Carrier_Grid->Cells[2][2] = "  15/12/31\n  08:47:57\n  12NL156";
	Carrier_Grid->Cells[2][3] = "  15/12/31\n  08:47:57\n  12NL153";
	Carrier_Grid->Cells[2][4] = "  15/12/31\n  08:47:57\n  12NL047\n  Lock";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[3][1] = "  15/12/31\n  08:47:57\n  12NL287";
	Carrier_Grid->Cells[3][2] = "  15/12/31\n  06:37:57\n  12NL156";
	Carrier_Grid->Cells[3][3] = "  idle";
	Carrier_Grid->Cells[3][4] = "  idle";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[4][1] = "  15/12/31\n  08:47:57\n  12NL987";
	Carrier_Grid->Cells[4][2] = "  idle";
	Carrier_Grid->Cells[4][3] = "  idle";
	Carrier_Grid->Cells[4][4] = "  idle";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[5][1] = "  15/12/31\n  08:47:57\n  12NL985";
	Carrier_Grid->Cells[5][2] = "  idle";
	Carrier_Grid->Cells[5][3] = "  idle";
	Carrier_Grid->Cells[5][4] = "  idle";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[6][1] = "  15/12/31\n  08:47:57\n  12NL924";
	Carrier_Grid->Cells[6][2] = "  idle";
	Carrier_Grid->Cells[6][3] = "  idle";
	Carrier_Grid->Cells[6][4] = "  idle";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[7][1] = "  15/12/31\n  08:47:57\n  12NL925";
	Carrier_Grid->Cells[7][2] = "  idle";
	Carrier_Grid->Cells[7][3] = "  Shut\n  down";
	Carrier_Grid->Cells[7][4] = "  ";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[8][1] = "  15/12/31\n  08:47:57\n  12NL926";
	Carrier_Grid->Cells[8][2] = "  idle";
	Carrier_Grid->Cells[8][3] = "  idle";
	Carrier_Grid->Cells[8][4] = "  idle";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[9][1] = "  15/12/31\n  08:47:57\n  12NL920";
	Carrier_Grid->Cells[9][2] = "  idle";
	Carrier_Grid->Cells[9][3] = "  idle";
	Carrier_Grid->Cells[9][4] = "  idle";
	//--------------------------------------------------------------
	Carrier_Grid->Cells[10][1] = "  15/12/31\n  08:47:57\n  12NL820";
	Carrier_Grid->Cells[10][2] = "  idle";
	Carrier_Grid->Cells[10][3] = "  idle";
	Carrier_Grid->Cells[10][4] = "  idle";
	//--------------------------------------------------------------
	*/

	Stocker_Grid->Cells[0][0] = "  	      Carrier ID  ";
	Stocker_Grid->Cells[1][0] = "   F/E  ";
	Stocker_Grid->Cells[2][0] = "  	   Current Location ID  ";
	Stocker_Grid->Cells[3][0] = "  	 Host Current Location  ";
	Stocker_Grid->Cells[4][0] = "  	     Carrier State  ";
	Stocker_Grid->Cells[5][0] = "  	   Carrier Alarm  ";
	Stocker_Grid->Cells[6][0] = "  	       Comment  ";
	Stocker_Grid->Cells[7][0] = "                  Installed  ";
	//--------------------------------------------------------------
	Stocker_Grid->Cells[0][1] = " 12NL047";
	Stocker_Grid->Cells[0][2] = " 12NL046";
	Stocker_Grid->Cells[0][3] = " 12NL287";
	Stocker_Grid->Cells[0][4] = " 12NL987";
	Stocker_Grid->Cells[0][5] = " 12NL985";
	Stocker_Grid->Cells[0][6] = " 12NL924";
	Stocker_Grid->Cells[0][7] = " 12NL925";
	Stocker_Grid->Cells[0][8] = " 12NL926";
	//--------------------------------------------------------------
	Stocker_Grid->Cells[1][1] = " Fill";
	Stocker_Grid->Cells[1][2] = " Fill";
	Stocker_Grid->Cells[1][3] = " Fill";
	Stocker_Grid->Cells[1][4] = " Fill";
	Stocker_Grid->Cells[1][5] = " Fill";
	Stocker_Grid->Cells[1][6] = " Fill";
	Stocker_Grid->Cells[1][7] = " Fill";
	Stocker_Grid->Cells[1][8] = " Fill";
	//--------------------------------------------------------------
	Stocker_Grid->Cells[2][1] = " STKA_01_T01B01";
	Stocker_Grid->Cells[2][2] = " STKA_01_T02B01";
	Stocker_Grid->Cells[2][3] = " STKA_01_T03B01";
	Stocker_Grid->Cells[2][4] = " STKA_01_T04B01";
	Stocker_Grid->Cells[2][5] = " STKA_01_T05B01";
	Stocker_Grid->Cells[2][6] = " STKA_01_T06B01";
	Stocker_Grid->Cells[2][7] = " STKA_01_T07B01";
	Stocker_Grid->Cells[2][8] = " STKA_01_T08B01";
	//--------------------------------------------------------------
	Stocker_Grid->Cells[3][1] = " STKA_01_T01B01";
	Stocker_Grid->Cells[3][2] = " STKA_01_T02B01";
	Stocker_Grid->Cells[3][3] = " STKA_01_T03B01";
	Stocker_Grid->Cells[3][4] = " STKA_01_T04B01";
	Stocker_Grid->Cells[3][5] = " STKA_01_T05B01";
	Stocker_Grid->Cells[3][6] = " STKA_01_T06B01";
	Stocker_Grid->Cells[3][7] = " STKA_01_T07B01";
	Stocker_Grid->Cells[3][8] = " STKA_01_T08B01";
	//--------------------------------------------------------------
	Stocker_Grid->Cells[4][1] = " Completed";
	Stocker_Grid->Cells[4][2] = " Completed";
	Stocker_Grid->Cells[4][3] = " Completed";
	Stocker_Grid->Cells[4][4] = " Completed";
	Stocker_Grid->Cells[4][5] = " Completed";
	Stocker_Grid->Cells[4][6] = " Completed";
	Stocker_Grid->Cells[4][7] = " Completed";
	Stocker_Grid->Cells[4][8] = " Completed";
	//--------------------------------------------------------------
	Stocker_Grid->Cells[7][1] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][2] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][3] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][4] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][5] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][6] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][7] = " 2015/12/31 08:47:57";
	Stocker_Grid->Cells[7][8] = " 2015/12/31 08:47:57";

	Stocker_Grid->ColWidths[0] = 140;
	Stocker_Grid->ColWidths[1] = 55;
	Stocker_Grid->ColWidths[2] = 180;
	Stocker_Grid->ColWidths[3] = 180;
	Stocker_Grid->ColWidths[4] = 160;
	Stocker_Grid->ColWidths[5] = 140;
	Stocker_Grid->ColWidths[6] = 150;
	Stocker_Grid->ColWidths[7] = 210;


	Alarm_Grid->Cells[0][0] = "  	      Alarm ID  ";
	Alarm_Grid->Cells[1][0] = "        Error Code  ";
	Alarm_Grid->Cells[2][0] = "  	       Name  ";
	Alarm_Grid->Cells[3][0] = "  	            Location  ";
	Alarm_Grid->Cells[4][0] = "  	                      Details  ";
	Alarm_Grid->Cells[5][0] = "  	              Start Time  ";
	Alarm_Grid->Cells[6][0] = "  	             Over Time  ";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[0][1] = " 2011";
	Alarm_Grid->Cells[0][2] = " 2010";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[1][1] = " 9007";
	Alarm_Grid->Cells[1][2] = " 12222";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[2][1] = " Port";
	Alarm_Grid->Cells[2][2] = " Shelf";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[3][1] = " STKA_01_L01";
	Alarm_Grid->Cells[3][2] = " STKA_01_T01B04";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[4][1] = " Area Sensor error";
	Alarm_Grid->Cells[4][2] = " STKA_01_T01B04 Shelf error";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[5][1] = " 2015/12/31 06:47:57";
	Alarm_Grid->Cells[5][2] = " 2015/12/31 06:47:20";
	//--------------------------------------------------------------
	Alarm_Grid->Cells[6][1] = " 2015/12/31 06:47:57";
	Alarm_Grid->Cells[6][2] = " 2015/12/31 06:47:20";
	//--------------------------------------------------------------

	Alarm_Grid->ColWidths[0] = 140;
	Alarm_Grid->ColWidths[1] = 140;
	Alarm_Grid->ColWidths[2] = 120;
	Alarm_Grid->ColWidths[3] = 180;
	Alarm_Grid->ColWidths[4] = 248;
	Alarm_Grid->ColWidths[5] = 200;
	Alarm_Grid->ColWidths[6] = 190;
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::AutoManual1Click(TObject *Sender)
{
	Change_AutoManual_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::LinkStatusChange1Click(TObject *Sender)
{
	Link_Status_Change_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::oAGVPort1Click(TObject *Sender)
{
	Carrier_ToAGVPort_Popup_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::oPGVPort1Click(TObject *Sender)
{
	Carrier_ToPGVPort_Popup_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::FormTo1Click(TObject *Sender)
{
	Carrier_FormTo_popup_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Lock1Click(TObject *Sender)
{
	Carrier_Lock_Comment_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Event1Click(TObject *Sender) //설정된 파일 열기
{
	ShellExecute(Handle, L"open", L"notepad", L"D:\\test.txt", 0, SW_SHOW);
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Operation2Click(TObject *Sender) //설정된 파일 열기
{
	ShellExecute(Handle, L"open", L"notepad", L"D:\\test.txt", 0, SW_SHOW);
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::HostCommunication1Click(TObject *Sender) //설정된 파일 열기
{
	ShellExecute(Handle, L"open", L"notepad", L"D:\\test.txt", 0, SW_SHOW);
}
//---------------------------------------------------------------------------


void __fastcall Tstkc_frm::LogFolder1Click(TObject *Sender)//설정된 폴더 Open
{
	ShellExecute(NULL, L"runas", L"explorer", L"D:\\Exercise", 0, SW_SHOWDEFAULT);
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Alarm1Click(TObject *Sender)
{
	History_Alarm_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Event2Click(TObject *Sender)
{
	History_Event_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::ransferCommand1Click(TObject *Sender)
{
	History_TransferCommand_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Operation3Click(TObject *Sender)
{
	History_Operation_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::CarrierHistory1Click(TObject *Sender)
{
	History_Carrier_History_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::N2Click(TObject *Sender)
{
	Statistics_WorkTime_frm->Show();
}
//---------------------------------------------------------------------------


void __fastcall Tstkc_frm::N1Click(TObject *Sender)
{
	Statistics_Time_statistics_process_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::UserManagement1Click(TObject *Sender)
{
	System_UserManagement_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::UserGrouping1Click(TObject *Sender)
{
	System_UserGrouping_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::MaxPoolLevel1Click(TObject *Sender)
{
	System_Max_PoolLevel_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::N3Click(TObject *Sender)
{
	Operation_ShelfTest_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::N4Click(TObject *Sender)
{
	Operation_Shelf_Position_Confirmation_frm->Show();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::Setting1Click(TObject *Sender)
{
	Setting_Frm->ShowModal();
}
//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::btn_loginClick(TObject *Sender)
{
	if (btn_login->Caption == "Login Here") {
		Login_frm->ShowModal();
	}
	else	{

		if (MessageDlg("Log Out?",mtConfirmation,TMsgDlgButtons() << mbYes << mbNo,0) == mrYes) {
			logout();
		}
	}

}
//---------------------------------------------------------------------------



void __fastcall Tstkc_frm::logout_timerTimer(TObject *Sender)
{
	if (logout_cnt >= logout_time )	{
		logout();
	}
	else	logout_cnt++;

}

void __fastcall Tstkc_frm::logout()
{
	PNT_ListBox(STK_SRVinfo.SRV_USER  + " LogOut");

	STK_SRVinfo.SRV_USER  = "";
	logout_time = 0;
	logout_cnt = 0;

	logout_timer->Enabled = false;

	stkc_frm->btn_login->Caption = "Login Here";

	EZGEM1->GoOffline();
}

//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::STKC_OnActive(TObject *Sender)
{
	Setting_Frm->Read_Setting();

	CarrierGrid_init();

	EZGEM_Init();


	lb_msg->Clear();

	STK_SRVinfo.SRV_NOWDATE = FormatDateTime("MM/DD/YY", Now());;
	STK_SRVinfo.SRV_NOWTIME = Time().TimeString();
    SaveMessage();

	EZGEM1->SendMsg(256);
}
//---------------------------------------------------------------------------
void __fastcall Tstkc_frm::CarrierGrid_init(void)
{
		gd_carrier->RemoveRows(0,10);
	gd_carrier->RemoveCols(0,3);

	int i, j, row, col;

	col = StrToInt(Setting_Frm->tb_col->Text );
	row = StrToInt(Setting_Frm->tb_row->Text );

	TStringList *pList = new TStringList;


	for(i=0 ; i <= col-1 ; i++){
		gd_carrier->AddColumn();
		pList->Add(printf("%00d",i));
	}
	gd_carrier->ColumnHeaders = pList;

	for(i=1 ; i <= gd_carrier->TotalColCount()-1 ; i++)
		gd_carrier->ColWidths[i]  = int( gd_carrier->Width /col);

	gd_carrier->ColWidths[0] = 25;

	for (j=0 ; j <= row - 1 ; j++)
		gd_carrier->AddRow();
	for (j=1 ; j < gd_carrier->TotalRowCount()-1 ; j++)
		gd_carrier->RowHeights[j] = int(gd_carrier->Height / row);

	gd_carrier->RowHeights[0] = 25;
}
//---------------------------------------------------------------------------
void __fastcall Tstkc_frm::EZGEM_Init()
{
	//---------------------------------------------------------------------------
//EZGEM Setting
	EZGEM1->T3 = Setting_Frm->tb_t3->Text.ToInt();
	EZGEM1->T5 = Setting_Frm->tb_t5->Text.ToInt();
	EZGEM1->T6 = Setting_Frm->tb_t6->Text.ToInt();
	EZGEM1->T7 = Setting_Frm->tb_t7->Text.ToInt();
	EZGEM1->T8 = Setting_Frm->tb_t8->Text.ToInt();
	EZGEM1->EstablishCommRetryTimer = Setting_Frm->tb_t9->Text.ToInt();

	if (Setting_Frm->cb_connect_mode->Text == "PASSIVE") {
		EZGEM1->PassiveMode = true;
	}
	else	EZGEM1->PassiveMode = False;

	EZGEM1->IP = Setting_Frm->AdvIPEdit2->IPAddress;
	EZGEM1->Port = Setting_Frm->tb_remote_port->Text.ToInt() ;
	EZGEM1->SecsI = False;

	EZGEM1->SetModelName(GetBstr("MODELNAME").c_bstr());
	EZGEM1->SetSoftwareRev(GetBstr("V1.00").c_bstr());

	EZGEM1->HostMode = true;

	EZGEM1->AddRemoteCommand(GetBstr("ABORT").c_bstr() );
	EZGEM1->AddRemoteCommand(GetBstr("CANCEL").c_bstr() );
	EZGEM1->AddRemoteCommand(GetBstr("TRANSFER").c_bstr() );
	EZGEM1->AddRemoteCommand(GetBstr("MOVE").c_bstr() );

	AddSVIDs();
	AddCEIDs();
	//AddECIDs();
	AddALIDs();

	EZGEM1->SetFormatCodeALID(54);
	EZGEM1->SetFormatCodeSVID(54);
	EZGEM1->SetFormatCodeDATAID(52);
	EZGEM1->SetFormatCodeCEID(54);
	//EZGEM1->SetFormatCodeECID(ITEM_UINT4B);
	EZGEM1->SetFormatCodeRPTID(54);
	EZGEM1->SetFormatCodeTRACEID(54);

	WideString sFile;
	sFile = "LOG\\GEM.LOG";
	EZGEM1->SetLogFile(GetBstr(sFile).c_bstr(),true);

	EZGEM1->DisableSpooling();

	sFile = "DATA\\FORMAT.SML";
	EZGEM1->SetFormatFile(GetBstr(sFile).c_bstr() );

	EZGEM1->SetLogRetention(30);
	EZGEM1->SetFormatCheck(true);

	//GemState->bEnabled = true;

	EZGEM1->DisableAutoReply(6,1);
	int res = EZGEM1->Start();


//	if(res < 0)
//		ShowMessage(GetErrorCode(res));

}
	//Add Status Variable ID
//AddSVID(id,name,format,unit)
void __fastcall Tstkc_frm::AddSVIDs(void)
{
	String sFile = "../../DATA\\VSP_SVID.TXT";
	if(!FileExists(sFile))
	{
		ShowMessage("SVID Definition file does not exist.");
		return;
	}

	boost::shared_ptr<TStringList> sLine (new TStringList());
	boost::shared_ptr<TStringList> sData (new TStringList());
	sLine->LoadFromFile(sFile);

	for(int i=0; i<sLine->Count; i++)
	{
		sData->CommaText = sLine->Strings[i];

		if(sData->Count != 3)
			continue;
		else
			EZGEM1->AddSVID((long)(sData->Strings[0].ToIntDef(0) ), GetBstr(sData->Strings[1]).c_bstr(), GetBstr(sData->Strings[2]).c_bstr(), GetBstr("").c_bstr() );
	}
}

//Add Collective Event ID
//AddCEID(id,name,comment)
void __fastcall Tstkc_frm::AddCEIDs(void)
{
	String sFile = "../../DATA\\VSP_CEID.TXT";
	if(!FileExists(sFile))
	{
		ShowMessage("CEID Definition file does not exist.");
		return;
	}

	boost::shared_ptr<TStringList> sLine (new TStringList());
	boost::shared_ptr<TStringList> sData (new TStringList());
	sLine->LoadFromFile(sFile);

	for(int i=0; i<sLine->Count; i++)
	{
		sData->CommaText = sLine->Strings[i];

		if(sData->Count < 2)
			continue;
		else
		{
			String sErrContents = "";
			for(int j=1; j<sData->Count; j++)
			{
				sErrContents = sErrContents + sData->Strings[j];
				sErrContents += " ";
			}
			EZGEM1->AddCEID((long)(sData->Strings[0].ToIntDef(0) ), GetBstr(sErrContents).c_bstr(), GetBstr("").c_bstr() );
        }
	}
}

//Add Equipment Constant ID
//AddECID(id,name,format,unit)
//void __fastcall Tstkc_frm::AddECIDs(void)
//{
//	WideString wsVal;
//
//	EZGEM1->add
//
//	EZGEM1->AddECID(ECID_PORT, GetBstr("PortNumber").c_bstr(), GetBstr("").c_bstr(), GetBstr("U2").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_PORT, GetBstr("2000").c_bstr(), GetBstr("10000").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_PORT, GetBstr(IntToStr(HsmsPara->nPort)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_DEVICEID,  GetBstr("DeviceID").c_bstr(),  GetBstr("").c_bstr(),  GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_DEVICEID, GetBstr("0").c_bstr(), GetBstr("255").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_DEVICEID, GetBstr(IntToStr(HsmsPara->nDeiceId)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_T3, GetBstr("T3 Timeout").c_bstr(), GetBstr("second").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_T3, GetBstr("1").c_bstr(), GetBstr("255").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_T3, GetBstr(IntToStr(HsmsPara->nT3)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_T5, GetBstr("T5 Timeout").c_bstr(), GetBstr("second").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_T5, GetBstr("1").c_bstr(), GetBstr("255").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_T5, GetBstr(IntToStr(HsmsPara->nT5)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_T6,	GetBstr("T6 Timeout").c_bstr(), GetBstr("second").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_T6, GetBstr("1").c_bstr(), GetBstr("255").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_T6, GetBstr(IntToStr(HsmsPara->nT6)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_T7, GetBstr("T7 Timeout").c_bstr(), GetBstr("second").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_T7, GetBstr("1").c_bstr(), GetBstr("255").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_T7, GetBstr(IntToStr(HsmsPara->nT7)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_T8, GetBstr("T8 Timeout").c_bstr(), GetBstr("second").c_bstr(), GetBstr("U1").c_bstr());
//	EZGEM1->SetEquipConstRange(ECID_T8, GetBstr("1").c_bstr(), GetBstr("255").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_T8, GetBstr(IntToStr(HsmsPara->nT8)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_LINKTEST, GetBstr("LinkTestInterVal").c_bstr(), GetBstr("second").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_LINKTEST, GetBstr("1").c_bstr(), GetBstr("255").c_bstr());
//	EZGEM1->SetEquipConstValue(ECID_LINKTEST, GetBstr(IntToStr(HsmsPara->nLnkTest)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_RETRY, GetBstr("RetryLimit").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_RETRY, GetBstr("1").c_bstr(), GetBstr("255").c_bstr());
//	EZGEM1->SetEquipConstValue(ECID_RETRY, GetBstr(IntToStr(HsmsPara->nRetry)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_DEFAULT_COMM_STATE, GetBstr("DefaultCommState").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_DEFAULT_COMM_STATE, GetBstr("1").c_bstr(), GetBstr("5").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_DEFAULT_COMM_STATE, GetBstr(IntToStr(static_cast<int>(Ecid->nDefaultCommState))).c_bstr() );
//
//	EZGEM1->AddECID(ECID_DEFAULT_CONTROL_STATE, GetBstr("DefaultControlState").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_DEFAULT_CONTROL_STATE, GetBstr("1").c_bstr(), GetBstr("3").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_DEFAULT_CONTROL_STATE, GetBstr(IntToStr(Ecid->nDefaultControlState)).c_bstr() );
//
//	EZGEM1->AddECID(ECID_ESTABLISH_TIMEOUT, GetBstr("EstablishCommTimeOut").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_ESTABLISH_TIMEOUT, GetBstr("1").c_bstr(), GetBstr("60").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_ESTABLISH_TIMEOUT, GetBstr(IntToStr(static_cast<int>(Ecid->nCommReqeustTimeout))).c_bstr() );
//
//	EZGEM1->AddECID(ECID_MDLN, GetBstr("MDLN").c_bstr(), GetBstr("").c_bstr(), GetBstr("A").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_MDLN, GetBstr(Ecid->sModelName).c_bstr() );
//
//	EZGEM1->AddECID(ECID_SOFTREV, GetBstr("SOFTREV").c_bstr(), GetBstr("").c_bstr(), GetBstr("A").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_SOFTREV, GetBstr(Ecid->sSoftRev).c_bstr() );
//
//	EZGEM1->AddECID(ECID_MAXSPOOL_TRANSMIT, GetBstr("MaxSpoolTransmit").c_bstr(), GetBstr("").c_bstr(), GetBstr("U2").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_MAXSPOOL_TRANSMIT, GetBstr("1").c_bstr(), GetBstr("8196").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_MAXSPOOL_TRANSMIT, GetBstr(IntToStr(static_cast<int>(Ecid->SPOOLINFO.nMaxSpoolTransmit))).c_bstr() );
//
//	EZGEM1->AddECID(ECID_SPOOL_OVERWRITE, GetBstr("SpoolOverwrite").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_SPOOL_OVERWRITE, GetBstr("0").c_bstr(), GetBstr("1").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_SPOOL_OVERWRITE, GetBstr(IntToStr(static_cast<int>(Ecid->SPOOLINFO.bSpoolOverwrite))).c_bstr() );
//
//	EZGEM1->AddECID(ECID_SPOOLING_MODE, GetBstr("SpoolingMode").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_SPOOLING_MODE, GetBstr("0").c_bstr(), GetBstr("1").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_SPOOLING_MODE, GetBstr(IntToStr(static_cast<int>(Ecid->SPOOLINFO.bSpoolEnabled))).c_bstr() );
//
//	EZGEM1->AddECID(ECID_MAX_SPOOL_SIZE,	GetBstr("MaxSpoolCount").c_bstr(), GetBstr("").c_bstr(), GetBstr("U2").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_MAX_SPOOL_SIZE, GetBstr("1").c_bstr(), GetBstr("8196").c_bstr() );
//	EZGEM1->SetEquipConstValue(ECID_MAX_SPOOL_SIZE, GetBstr(IntToStr(static_cast<int>(Ecid->SPOOLINFO.nMaxSpoolSize))).c_bstr() );
//
//	EZGEM1->AddECID(ECID_TIME_FORMAT, GetBstr("TimeFormat").c_bstr(), GetBstr("").c_bstr(), GetBstr("U1").c_bstr() );
//	EZGEM1->SetEquipConstRange(ECID_TIME_FORMAT, GetBstr("12").c_bstr(), GetBstr("16").c_bstr() );
//
//
//	if(Ecid->nTimeFormat == 12)
//		EZGEM1->SetEquipConstValue(ECID_TIME_FORMAT, GetBstr("0").c_bstr() );
//	else if (Ecid->nTimeFormat == 16)
//		EZGEM1->SetEquipConstValue(ECID_TIME_FORMAT, GetBstr("1").c_bstr() );
//}

//Add Alarm ID
//AddAlarmID(id,name,comment)
void __fastcall Tstkc_frm::AddALIDs(void)
{
//	GetCurrentDir() + "\\DATA\\VSP_ALID.TXT"
	String sFile = "../../DATA\\VSP_ALID.TXT";
	if(!FileExists(sFile))
	{
		ShowMessage("ALID Definition file does not exist.");
		return;
	}

	boost::shared_ptr<TStringList> sLine (new TStringList());
	boost::shared_ptr<TStringList> sData (new TStringList());
	sLine->LoadFromFile(sFile);

	for(int i=0; i<sLine->Count; i++)
	{
		sData->Delimiter = '\t';
		sData->DelimitedText = sLine->Strings[i];

		if(sData->Count < 2)
			continue;
		else
		{
			String sErrContents = "";
			for(int j=1; j<sData->Count; j++)
			{
				sErrContents = sErrContents + sData->Strings[j];
				sErrContents += " ";
			}

			EZGEM1->AddAlarmID((long)(sData->Strings[0].ToIntDef(0) ), GetBstr(sData->Strings[1]).c_bstr(), GetBstr(sErrContents).c_bstr() );
        }
	}
}

//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::EZGEM1_OnConnected(TObject *Sender)
{
	//lb_msg->Items->Add("123456789012345678901234567890123456");
	//lb_msg->Items->Add(Now().DateTimeString());
	PNT_ListBox("Connected");

	EZGEM1->GoOnlineRemote();
	EZGEM1->EnableCommunication();
	EZGEM1->GoOnlineRemote();

	S1F13();
}
//---------------------------------------------------------------------------
void __fastcall Tstkc_frm::S1F13(void)
{
//	if(GemState->bConnectedFg == true){
		WideString ASK_MDLN = "TEST_MDLN";				//A[6]
		WideString ASK_SOFTREV = "TEST_SOFTREV";		//A[6]

		long lMsgID;

		AnsiString str;

		lMsgID = EZGEM1->CreateMsg(1,13,1);

		EZGEM1->OpenListItem(lMsgID);
			EZGEM1->AddAsciiItem(lMsgID, GetBstr(ASK_MDLN).c_bstr(), ASK_MDLN.Length());
			EZGEM1->AddAsciiItem(lMsgID, GetBstr(ASK_SOFTREV).c_bstr(), ASK_MDLN.Length());
		EZGEM1->CloseListItem(lMsgID);

		EZGEM1->SendMsg(lMsgID);

//	}
}


//---------------------------------------------------------------------------
void __fastcall Tstkc_frm::PNT_ListBox(String msg)
{
	String buf = Now().DateTimeString();

	int a, b;

	String str = ToUpper(msg);
	a = buf.Length();
	b = msg.Length();

	String temp = "";

	for (int i=0; i < 60-a-b-2  ; i++) {
		temp += ".";
	}
	String aa =buf + " " + temp + " " + str;
	int bb = aa.Length();

	lb_msg->Items->Add(buf + " " + temp + " " + str);


}


void __fastcall Tstkc_frm::EZGEM1_OnDisConnected(TObject *Sender)
{
	PNT_ListBox("Disconnected");
}
//---------------------------------------------------------------------------


//---------------------------------------------------------------------------


void __fastcall Tstkc_frm::EZGEM1SecsMsgIn(TObject *Sender, short nStream, short nFunction,
		  short nWbit, long lSysByte)
{
	//EZGEM11->EnableAutoReply(nStream,nFunction );


}
//---------------------------------------------------------------------------

//---------------------------------------------------------------------------

void __fastcall Tstkc_frm::pn_lrDblClick(TObject *Sender)
{
	if(STK_SRVinfo.SRV_LOCAL_REMOTE_STATE  == "REMOTE")
	{
		if (MessageDlg("REMODTE -> LOCAL?",mtConfirmation,TMsgDlgButtons() << mbYes << mbNo,0) == mrYes) {
			EZGEM1->GoOnlineLocal();
			STK_SRVinfo.SRV_LOCAL_REMOTE_STATE = "LOCAL";
			PNT_ListBox("REMODTE -> LOCAL");
			pn_lr->Caption = "ONLINE / LOCAL";
		}
	}
	else
	{
		if (MessageDlg("LOCAL -> REMOTE?",mtConfirmation,TMsgDlgButtons() << mbYes << mbNo,0) == mrYes) {
			EZGEM1->GoOnlineRemote();
			STK_SRVinfo.SRV_LOCAL_REMOTE_STATE = "REMOTE";
						PNT_ListBox("LOCAL -> REMOTE");
			pn_lr->Caption = "ONLINE / REMOTE";
		}
    }
}

//---------------------------------------------------------------------------
  void __fastcall Tstkc_frm::SaveMessage(void)
  {
	AnsiString dir = GetCurrentDir();
	char cA[255];


	dir += "\\MessageLog\\";

	AnsiString str = dir + STK_SRVinfo.SRV_NOWDATE + ".txt";




	if (!DirectoryExists(ExtractFilePath(str)))
	{
		ForceDirectories(ExtractFilePath(str));
		CreateFileA(str.c_str() , GENERIC_READ|GENERIC_WRITE, 0, NULL, OPEN_ALWAYS , FILE_ATTRIBUTE_NORMAL|FILE_FLAG_NO_BUFFERING|FILE_FLAG_SEQUENTIAL_SCAN, NULL);
	}
}

//---------------------------------------------------------------------------



